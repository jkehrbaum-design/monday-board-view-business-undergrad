<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bachelor‚Äôs Programs ‚Äì Freshman & Average Student</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#f6f7fb; --card:#ffffff; --text:#1f2430; --muted:#6b7280; --line:#eaedf2;
  --primary:#1f76ff; --pill:#eef3ff; --pillText:#1f4fbf; --link:#1f76ff; --thead:#f2f4f8;
  --chip:#f4f6fa; --chipText:#49506a; --stickyW:300px;
}
*{box-sizing:border-box} html,body{height:100%}
body{ margin:0; background:var(--bg); color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; }
.wrap{max-width:1200px;margin:24px auto;padding:0 20px;}
.h1{font-size:28px;font-weight:700;margin:8px 0 4px;}
.sub{color:var(--muted);font-size:13px;margin-bottom:18px;}

.row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
.col{display:flex;flex-direction:column;gap:6px}
.label{font-size:12px;color:var(--muted)}
input,select{height:36px;padding:0 10px;border:1px solid var(--line);border-radius:8px;background:#fff;color:#1f2430;min-width:120px;}
.nums{width:110px;text-align:right}
.btn{height:36px;padding:0 14px;border-radius:8px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:8px;}
.btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
.chips{display:flex;gap:8px;align-items:center;font-size:12px}
.chip{background:var(--chip);color:var(--chipText);padding:4px 8px;border-radius:999px}
.muted{color:var(--muted)}
.spacer{flex:1}
.toggle{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#444}

/* Toolbar */
.toolbar{position:sticky;top:0;z-index:20;background:var(--card);border:1px solid var(--line);border-radius:10px;padding:8px;margin-bottom:10px;display:flex;align-items:center;gap:6px;}
.tb-btn{height:30px;padding:0 10px;border:1px solid var(--line);background:#fff;border-radius:8px;font-weight:600;display:inline-flex;align-items:center;gap:6px;cursor:pointer;}
.tb-btn .ico{font-size:14px;line-height:1}
.sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}

/* Popovers */
.popover{position:absolute;top:44px;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 12px 30px rgba(0,0,0,.10);padding:12px;display:none;min-width:340px;}
.popover.open{display:block}
#pvHide{min-width:260px} #pvSort{min-width:260px}
.pv-row{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
.pv-row-inline{display:flex;gap:10px;align-items:center}
.pv-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
.pv-actions{display:flex;align-items:center;gap:8px;margin-top:8px}

/* Top scrollbar */
.hScrollTop{position:sticky;top:0;z-index:18;background:var(--card);border:1px solid var(--line);border-radius:10px;margin-bottom:8px;height:12px;overflow-x:auto;overflow-y:hidden;}
.hScrollInner{height:1px;}

/* Table */
.tableWrap{background:var(--card);border:1px solid var(--line);border-radius:10px;overflow:auto;position:relative;max-height:70vh;}
table{border-collapse:separate;border-spacing:0;width:max-content;min-width:1200px;}
thead th{position:sticky;top:0;background:var(--thead);z-index:5;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.02em;color:#49506a;padding:8px 12px;min-height:44px;border-bottom:1px solid var(--line);user-select:none;cursor:pointer;box-shadow:0 1px 0 var(--line),0 1px 6px rgba(0,0,0,0.04);}
thead th.sortable::after{content:" ‚áÖ";font-size:10px;color:#999;margin-left:4px;}
thead th.sort-asc::after{content:" ‚ñ≤";} thead th.sort-desc::after{content:" ‚ñº";}
tbody td{padding:10px 12px;line-height:20px;min-height:44px;border-top:1px solid var(--line);vertical-align:middle;font-size:14px;max-width:280px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
tbody td.trunc{cursor:pointer}
th.sticky, td.sticky{position:sticky;left:0;background:#fff;z-index:6;min-width:var(--stickyW);max-width:var(--stickyW);box-shadow:1px 0 0 var(--line);}
thead th.sticky{z-index:7;left:0;}
tbody tr:hover td{background:#f8fafc}

.pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:var(--pill);color:var(--pillText);font-size:12px;line-height:18px;}
.link{color:var(--link);text-decoration:none;font-weight:600}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
.right{text-align:right}

/* Loader */
#loader{position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;color:#333;z-index:2000;}
.spinner{width:48px;height:48px;border:4px solid #eee;border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-right:12px;}
@keyframes spin{to{transform:rotate(360deg)}}

/* Popup */
#popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:16px 18px;border:1px solid var(--line);border-radius:10px;box-shadow:0 12px 30px rgba(0,0,0,.15);z-index:3000;max-width:700px;max-height:70vh;overflow:auto;}
#popupClose{position:absolute;top:8px;right:12px;cursor:pointer;font-weight:700;}
#popup h4{margin:0 24px 10px 0;font-size:14px;color:#555;}
#popup pre{white-space:pre-wrap;word-break:break-word;font-family:inherit;font-size:14px;margin:0;}
.little-spinner{width:14px;height:14px;border:2px solid #e2e8f0;border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite;}

/* Dimension hotfix (wider) */
.wrap{max-width:none;width:min(1800px,98vw);padding:0 12px;}
.hScrollTop,.tableWrap{width:100%;}
@media (min-height:800px){ .tableWrap{max-height:76vh;} }
@media (min-width:1600px){ .wrap{width:min(2000px,96vw);} }
</style>
</head>

<body>
<!-- Loader -->
<div id="loader"><div class="spinner"></div>Loading data‚Ä¶</div>
<!-- Error banner -->
<div id="errorBanner" style="display:none;margin:10px 0;padding:10px 12px;border:1px solid #f59e0b;background:#fff8e1;border-radius:8px;color:#7c2d12;font-size:13px"></div>

<div class="wrap" id="app" style="display:none">
  <div class="h1">Bachelor‚Äôs Programs ‚Äì Freshman & Average Student</div>
  <div class="sub">The data comes from a secure Netlify function (read-only). The look and feel is inspired by Monday.</div>

  <!-- ======= TOOLBAR ======= -->
  <div class="toolbar" id="toolbar">
    <div class="toolbar-title sr-only">Table actions</div>
    <button class="tb-btn" id="tbHide"><span class="ico">üôà</span> Hide fields</button>
    <button class="tb-btn" id="tbFilter"><span class="ico">‚éö</span> Filter</button>
    <button class="tb-btn" id="tbGroup"><span class="ico">‚ñ¶</span> Group</button>
    <button class="tb-btn" id="tbSort"><span class="ico">‚Üï</span> Sort</button>
    <div class="spacer"></div>
    <button class="tb-btn" id="tbMore">‚Ä¶</button>

    <!-- POPUPS -->
    <div class="popover" id="pvHide"></div>

    <!-- FILTER POPOVER -->
    <div class="popover" id="pvFilter">
      <div class="pv-row"><label style="font-weight:600">Add a filter</label></div>
      <div class="pv-row-inline">
        <select id="fltCol" style="min-width:240px"></select>
        <select id="fltOp" style="min-width:140px">
          <option value="contains" selected>contains</option>
          <option value="equals">equals</option>
          <option value="starts">starts with</option>
          <option value="ends">ends with</option>
          <option value="empty">is empty</option>
          <option value="notempty">is not empty</option>
        </select>
        <input id="fltVal" placeholder="value‚Ä¶" style="min-width:220px" />
      </div>
      <div class="pv-actions">
        <div class="spacer"></div>
        <button class="btn" id="fltResetBtn">Reset</button>
        <button class="btn primary" id="fltApplyBtn">Apply</button>
      </div>
    </div>

    <div class="popover" id="pvGroup">
      <label>Group by</label>
      <select id="groupBy">
        <option value="">None</option>
        <option value="state">State</option>
        <option value="type">Type of Institution</option>
        <option value="geo_area">Geographical Area</option>
      </select>
    </div>

    <div class="popover" id="pvSort">
      <label>Sort by</label>
      <select id="sortKey"></select>
      <div class="pv-row-inline">
        <label><input type="radio" name="sortDir" value="asc" checked /> Asc</label>
        <label><input type="radio" name="sortDir" value="desc" /> Desc</label>
      </div>
    </div>

    <div class="popover" id="pvMore">
      <div class="pv-row-inline">
        <button class="btn" id="reloadBtn"><div class="little-spinner" id="reloadSpin" style="display:none"></div>Reload</button>
        <button class="btn" id="exportBtn">Export Excel</button>
        <button class="btn" id="moreBtn"><div class="little-spinner" id="moreSpin" style="display:none"></div>Load more</button>
      </div>
      <div class="muted" style="margin-top:8px">
        <span id="shown" class="chip">0 shown</span>
        <span id="loaded" class="chip">0 loaded</span>
      </div>
    </div>
  </div>
  <!-- ======= /TOOLBAR ======= -->

  <!-- TOP HORIZONTAL SCROLLBAR -->
  <div class="hScrollTop" id="hScrollTop"><div class="hScrollInner" id="hScrollInner"></div></div>

  <!-- TABLE -->
  <div class="tableWrap" id="tableWrap">
    <table id="tbl">
      <thead><tr id="thead-row"></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<!-- Popup for full cell text -->
<div id="popup">
  <span id="popupClose">‚úï</span>
  <h4 id="popupTitle">Details</h4>
  <pre id="popupBody"></pre>
</div>

<script>
(function(){
  // ===== 1) EDIT COLUMNS HERE (single source of truth) =======================
  // Each object = one column. Set: key, title, colId (Monday), and behavior.
  // type: 'text' | 'number' | 'money' | 'chip' | 'link' | 'mono' (monospace)
  // chipCategory (for 'chip'): 'state' | 'geo' | 'status' | 'type'
  // align: 'left' | 'right'
  // sticky: true to freeze the first column (use only on Name)
  // sortable: true to allow header sort click
  // trunc: true to enable click-to-expand popup for long text
  const COLUMNS = [
    { key:'name',           title:'Name', sticky:true,  sortable:true, type:'text',  colId:'name' },
    { key:'photos_desc',    title:'Photos & Description (Link) ‚ÜóÔ∏è', type:'link',   colId:'link4' },
    { key:'state',          title:'State',              sortable:true, type:'chip',  colId:'state1', chipCategory:'state' },
    { key:'geo_area',       title:'Geo_
